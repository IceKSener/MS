import{_ as C,g as h,u as M,r as _,a as N,o as d,c as p,b as a,w as E,v as I,n as o,d as l,e as V,f as j,F as D,h as F,t as L,i as O,j as P,k as R,l as z}from"./index-D6BrXSGY.js";const J={class:"question"},K={key:0},Q={__name:"AskAnswer",setup($){let k=h().proxy.api,m=h().proxy.config,i=h().proxy.screen;const v=M("answers"),u=_([]),c=_(""),S=s=>new Promise(e=>setTimeout(e,s));async function g(s){if(s=s.trim(),s.length<=0)return;if(!m.loginStatus.isLogged){R.emit("startLogin");return}let e=z({question:s,text:"",status:"unfinished"}),r="",t=[];u.value.forEach(n=>{n.status!="error"&&(t.push({role:"user",content:n.question}),t.push({role:"assistant",content:n.text}))}),t.push({role:"user",content:s}),console.log({model:"Qwen2.5-Math-7B-Instruct",messages:t,max_tokens:1e3,temperature:1}),fetch(k.path+"/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer "+m.loginStatus.access,"Content-Type":"application/json"},body:JSON.stringify({model:"Qwen2.5-Math-7B-Instruct",messages:t,max_tokens:1e3,temperature:1})}).then(n=>{const T=n.body.getReader(),A=new TextDecoder;function w(){T.read().then(({done:q,value:B})=>{if(q){e.status="finished";return}let y=A.decode(B,{stream:!0});console.log(y);let x=JSON.parse(y);if(x.final){e.status="finished";return}r+=x.choices[0].message.content,w()})}w()}).catch(n=>{r+="请求出错",e.status="error",console.error(n)}),u.value.push(e),setTimeout(()=>v.value.scrollTo(0,Number.MAX_SAFE_INTEGER),100);let f=0;for(;;){if(f<r.length)e.text+=r.at(f),++f;else if(e.status!="unfinished")break;await S(1e3/m.settings.charPerSecond)}}function b(){u.value.length=0}return(s,e)=>{const r=N("Markdown");return d(),p("div",{class:o(["area",l(i).type])},[a("div",{class:o(["request",l(i).type])},[E(a("textarea",{type:"text",class:o(["requestbox",l(i).type]),"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),placeholder:"输入问题",onKeyup:e[1]||(e[1]=V(j(t=>g(c.value),["exact"]),["enter"]))},null,34),[[I,c.value]]),a("div",{class:o(["submit",l(i).type]),onClick:e[2]||(e[2]=t=>g(c.value))},"提问",2)],2),a("div",{class:o(["answers",l(i).type]),ref_key:"answers",ref:v},[a("div",null,[a("button",{onClick:b},"清空")]),(d(!0),p(D,null,F(u.value,t=>(d(),p("div",{class:o(["chat",t.status])},[a("div",J,L(t.question),1),O(r,{class:"answer",md:t.text},null,8,["md"]),t.status=="unfinished"?(d(),p("div",K,"......")):P("",!0)],2))),256))],2)],2)}}},U=C(Q,[["__scopeId","data-v-6127e9fa"]]);export{U as default};
