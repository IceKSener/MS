import{_ as M,g as h,u as N,r as x,a as q,o as u,c,b as n,w as I,v as E,n as o,d as i,e as V,f as j,F as D,h as F,t as L,i as O,j as P,k as R,l as z}from"./index-CPqhdPw1.js";const J={class:"question"},K={key:0},Q={__name:"AskAnswer",setup($){let k=h().proxy.api,d=h().proxy.config,r=h().proxy.screen;const v=N("answers"),p=x([]),l=x(""),S=s=>new Promise(e=>setTimeout(e,s));async function g(s){if(s=s.trim(),s.length<=0)return;if(!d.loginStatus.isLogged){R.emit("startLogin");return}let e=z({question:s,text:"",status:"unfinished"}),a="",t=[];t.push({role:"user",content:s}),console.log({model:"Qwen2.5-Math-7B-Instruct",messages:t,max_tokens:1e3,temperature:1}),fetch(k.path+"/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer "+d.loginStatus.userinfo.access,"Content-Type":"application/json"},body:JSON.stringify({model:"Qwen2.5-Math-7B-Instruct",messages:t,max_tokens:1e3,temperature:1})}).then(f=>{const T=f.body.getReader(),A=new TextDecoder;function w(){T.read().then(({done:B,value:C})=>{if(B){e.status="finished";return}let y=A.decode(C,{stream:!0});console.log(y);let _=JSON.parse(y);if(_.final){e.status="finished";return}a+=_.choices[0].message.content,w()})}w()}).catch(f=>{a+="请求出错",e.status="error",console.error(f)}),p.value.push(e),setTimeout(()=>v.value.scrollTo(0,Number.MAX_SAFE_INTEGER),100);let m=0;for(;;){if(m<a.length)e.text+=a.at(m),++m;else if(e.status!="unfinished")break;await S(1e3/d.settings.charPerSecond)}}function b(){p.value.length=0}return(s,e)=>{const a=q("Markdown");return u(),c("div",{class:o(["area",i(r).type])},[n("div",{class:o(["request",i(r).type])},[I(n("textarea",{type:"text",class:o(["requestbox",i(r).type]),"onUpdate:modelValue":e[0]||(e[0]=t=>l.value=t),placeholder:"输入问题",onKeyup:e[1]||(e[1]=V(j(t=>g(l.value),["exact"]),["enter"]))},null,34),[[E,l.value]]),n("div",{class:o(["submit",i(r).type]),onClick:e[2]||(e[2]=t=>g(l.value))},"提问",2)],2),n("div",{class:o(["answers",i(r).type]),ref_key:"answers",ref:v},[n("div",null,[n("button",{onClick:b},"清空")]),(u(!0),c(D,null,F(p.value,t=>(u(),c("div",{class:o(["chat",t.status])},[n("div",J,L(t.question),1),O(a,{class:"answer",md:t.text},null,8,["md"]),t.status=="unfinished"?(u(),c("div",K,"......")):P("",!0)],2))),256))],2)],2)}}},U=M(Q,[["__scopeId","data-v-772f9825"]]);export{U as default};
