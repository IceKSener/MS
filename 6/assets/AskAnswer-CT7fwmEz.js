import{_ as M,g as y,u as j,r as S,a as E,o as d,c as p,b as a,w as I,v as O,n as o,d as u,e as V,f as D,F,h as L,t as P,i as R,j as z,k as J,l as K}from"./index-CRJV3Pew.js";const $={class:"question"},G={key:0},Q={__name:"AskAnswer",setup(U){let T=y().proxy.api,f=y().proxy.config,i=y().proxy.screen;const x=j("answers"),m=S([]),c=S(""),A=s=>new Promise(e=>setTimeout(e,s));async function _(s){if(s=s.trim(),s.length<=0)return;if(!f.loginStatus.isLogged){J.emit("startLogin");return}let e=K({question:s,text:"",status:"unfinished"}),n="",t=[];t.push({role:"user",content:s}),fetch(T.path+"/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer "+f.loginStatus.userinfo.access,"Content-Type":"application/json"},body:JSON.stringify({model:"Qwen2.5-Math-7B-Instruct",messages:t,max_tokens:1e3,temperature:1})}).then(v=>{const N=v.body.getReader(),q=new TextDecoder;let r="";function k(){N.read().then(({done:g,value:B})=>{if(g){e.status="finished";return}r+=q.decode(B,{stream:!0}),console.log("目前处理字符串："+r);let w=0,l=0;for(;l=r.indexOf("}",w)+1,l!=0;)try{let b=JSON.parse(r.substring(0,l));if(b.final){e.status="finished";return}n+=b.choices[0].message.content,r=r.substring(l),w=0}catch{w=l}k()}).catch(g=>{n+="请求出错",e.status="error",console.error(g)})}k()}).catch(v=>{n+="请求出错",e.status="error",console.error(v)}),m.value.push(e),setTimeout(()=>x.value.scrollTo(0,Number.MAX_SAFE_INTEGER),100);let h=0;for(;;){if(h<n.length)e.text+=n.at(h),++h;else if(e.status!="unfinished")break;await A(1e3/f.settings.charPerSecond)}}function C(){m.value.length=0}return(s,e)=>{const n=E("Markdown");return d(),p("div",{class:o(["area",u(i).type])},[a("div",{class:o(["request",u(i).type])},[I(a("textarea",{type:"text",class:o(["requestbox",u(i).type]),"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),placeholder:"输入问题",onKeyup:e[1]||(e[1]=V(D(t=>_(c.value),["exact"]),["enter"]))},null,34),[[O,c.value]]),a("div",{class:o(["submit",u(i).type]),onClick:e[2]||(e[2]=t=>_(c.value))},"提问",2)],2),a("div",{class:o(["answers",u(i).type]),ref_key:"answers",ref:x},[a("div",null,[a("button",{onClick:C},"清空")]),(d(!0),p(F,null,L(m.value,t=>(d(),p("div",{class:o(["chat",t.status])},[a("div",$,P(t.question),1),R(n,{class:"answer",md:t.text},null,8,["md"]),t.status=="unfinished"?(d(),p("div",G,"......")):z("",!0)],2))),256))],2)],2)}}},H=M(Q,[["__scopeId","data-v-55a7892a"]]);export{H as default};
