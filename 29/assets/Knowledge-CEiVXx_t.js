import{g as I,h as z,c as p,o as r,j as Z,u as k,_ as S,e as f,r as M,s as P,i as e,w as h,l as A,x as O,y as U,z as q,v as w,A as G,F as b,k as $,t as u,B as N,C as T,D as K,E as D,m as Y,n as L,G as H,K as J}from"./index-BA9c2F9m.js";const Q=`# 知识库上传说明\r
\r
知识库文件为jsonl格式和后缀，每行为包含\`id\`, \`label\`, \`name\`, \`desc\`, \`relation\`字段的json数据\r
\r
|字段|含义|必须|\r
|-|-|-|\r
|id|该条数据的id|×|\r
|label|该条数据的id|〇|\r
|name|该条数据的id|〇|\r
|desc|该条数据的id|〇|\r
|relation|该条数据的id|〇|\r
`,W={__name:"Usage",setup(F){const c=I().proxy.config.settings;return(m,n)=>{const a=z("Markdown");return r(),p("div",null,[Z(a,{class:"md",md:k(Q),theme:k(c).theme},null,8,["md","theme"])])}}},X={class:"panelArea"},ee={class:"funcs"},te={class:"funcSearch"},se={class:"items"},le={class:"loading"},ne={border:"1",cellspacing:"0"},ae=["title"],oe=["title"],ie=["title"],re=["title"],de=["title"],ce={style:{"max-width":"55px"}},ue=["onClick"],pe={class:"pages"},me=["value"],V=30,_e={__name:"Library",setup(F){const c=I().proxy.F,m=f(),n=f([]),a=M({items:n.value,ready:!1});async function y(){a.ready=!1;let o=await c.myFetchApi("/knowledge/get_user_knowledges",{expectCodes:[200],errorText:"用户知识库获取失败，请刷新重试"});o&&(n.value=o.data,a.items===n.value&&(a.ready=!0)),a.ready=!0}y();const v=f(0),_=P(()=>{let o=[];for(let t=0;t<a.items.length;t+=V)o.push(a.items.slice(t,t+V));return o});function g(){const o=m.value;o.removeEventListener("change",g);let t=[],s=[];for(let x of o.files){console.log(x);let B=new FormData;B.append("file",x),s.push(c.myFetchApi("/knowledge/upload_jsonl_knowledges",{expectCodes:[200,201],onError(De,R){t.push(x.name),console.error(R)}},{data:B}))}Promise.all(s).then(()=>{t.length>=0?T.emit("dialog",{text:`文件上传失败:
`+t.join(`
`)}):T.emit("dialog",{text:`上传成功:
`+t.join(`
`)}),o.files.length>t.length&&y()})}function C(){const o=m.value;o.value="",o.addEventListener("change",g),o.click()}const d=f(""),l=f([]);async function i(){let o=d.value.trim();if(o){a.ready=!1;try{let t=await c.myFetchApi("/knowledge/query_user_knowledge?part_name="+o,{expectCodes:[200],errorText:`"${o}" 查询失败`});t&&(l.value=t.data,a.items=l.value)}finally{a.ready=!0}}else a.items=n.value}function E(o){function t(){c.myFetchApi("/knowledge/del_knowledge/"+o.id,{expectCodes:[200],errorText:`${o.name}删除失败`},{method:"DELETE"}).then(s=>{s&&(y(),a.items===l.value&&i())})}settings.comfBefDelKnow?T.emit("dialog",{text:"确定删除该条知识吗？",onYes(s){settings.comfBefDelKnow=s,t()},checkText:"每次删除都提示确认",checkVal:!0,type:"yes_no"}):t()}return(o,t)=>(r(),p("div",X,[e("div",ee,[e("input",{type:"file",style:{display:"none"},accept:".jsonl",multiple:"",ref_key:"fileSelector",ref:m},null,512),e("div",{class:"func buttonEffect",onClick:C},t[2]||(t[2]=[e("img",{src:O,alt:"+"},null,-1),A(" 上传文件")])),e("div",te,[e("div",{class:"text buttonEffect",onClick:i},"知识查询"),h(e("input",{class:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>d.value=s),onKeyup:q(i,["enter"])},null,544),[[U,d.value]])])]),e("div",se,[h(e("div",le,t[3]||(t[3]=[e("img",{class:"autoInvert",src:G,alt:""},null,-1),A(" 加载中 ")]),512),[[w,!a.ready]]),e("table",ne,[t[4]||(t[4]=e("thead",{style:{position:"sticky",top:"0","background-color":"var(--bgColor)"}},[e("tr",null,[e("th",{width:"80px"},"id"),e("th",{width:"120px"},"label"),e("th",{width:"120px"},"name"),e("th",null,"desc"),e("th",{width:"120px"},"relation"),e("th",{width:"55px"},"操作")])],-1)),e("tbody",null,[(r(!0),p(b,null,$(_.value[v.value],s=>(r(),p("tr",null,[e("td",{style:{"max-width":"80px"},title:s.id},u(s.id),9,ae),e("td",{style:{"max-width":"120px"},title:s.label},u(s.label),9,oe),e("td",{style:{"max-width":"120px"},title:s.name},u(s.name),9,ie),e("td",{style:{"max-width":"0"},title:s.desc},u(s.desc),9,re),e("td",{style:{"max-width":"120px"},title:s.relation},u(s.relation),9,de),e("td",ce,[e("div",{class:"delBtn buttonEffect",onClick:x=>E(s)},"删除",8,ue)])]))),256))])])]),h(e("div",pe,[t[5]||(t[5]=e("div",{style:{"margin-right":"10px"}},"页数",-1)),h(e("select",{class:"pageTurn","onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s)},[(r(!0),p(b,null,$(_.value,(s,x)=>(r(),p("option",{value:x},u(x+1),9,me))),256))],512),[[N,v.value]])],512),[[w,_.value.length>1]])]))}},ve=S(_e,[["__scopeId","data-v-231e924e"]]),he={class:"panelArea"},fe={class:"funcs"},ye={class:"funcSearch"},xe={class:"items"},ge={class:"loading"},we={border:"1",cellspacing:"0"},ke=["title"],be=["title"],$e=["title"],Ce=["title"],Ee=["title"],Ie={class:"pages"},Fe=["value"],j=30,Te={__name:"LibraryInter",setup(F){const c=I().proxy.F,m=f([]),n=M({items:m.value,ready:!1});async function a(){n.ready=!1;let d=await c.myFetchApi("/knowledge/get_inner_knowledges",{expectCodes:[200],errorText:"内部知识库获取失败，请刷新重试"});d&&(m.value=d.data,n.items===m.value&&(n.ready=!0)),n.ready=!0}a();const y=f(0),v=P(()=>{let d=[];for(let l=0;l<n.items.length;l+=j)d.push(n.items.slice(l,l+j));return d}),_=f(""),g=f([]);async function C(){let d=_.value.trim();if(d){n.ready=!1;try{let l=await c.myFetchApi("/knowledge/query_inner_knowledge?part_name="+d,{expectCodes:[200],errorText:`"${d}" 查询失败`});l&&(g.value=l.data,n.items=g.value)}finally{n.ready=!0}}else n.items=m.value}return(d,l)=>(r(),p("div",he,[e("div",fe,[e("div",ye,[e("div",{class:"text buttonEffect",onClick:C},"知识查询"),h(e("input",{class:"input",type:"text","onUpdate:modelValue":l[0]||(l[0]=i=>_.value=i),onKeyup:q(C,["enter"])},null,544),[[U,_.value]])])]),e("div",xe,[h(e("div",ge,l[2]||(l[2]=[e("img",{class:"autoInvert",src:G,alt:""},null,-1),A(" 加载中 ")]),512),[[w,!n.ready]]),e("table",we,[l[3]||(l[3]=e("thead",{style:{position:"sticky",top:"0","background-color":"var(--bgColor)"}},[e("tr",null,[e("th",{width:"80px"},"id"),e("th",{width:"120px"},"label"),e("th",{width:"120px"},"name"),e("th",null,"desc"),e("th",{width:"120px"},"relation")])],-1)),e("tbody",null,[(r(!0),p(b,null,$(v.value[y.value],i=>(r(),p("tr",null,[e("td",{style:{"max-width":"80px"},title:i.id},u(i.id),9,ke),e("td",{style:{"max-width":"120px"},title:i.label},u(i.label),9,be),e("td",{style:{"max-width":"120px"},title:i.name},u(i.name),9,$e),e("td",{style:{"max-width":"0"},title:i.desc},u(i.desc),9,Ce),e("td",{style:{"max-width":"120px"},title:i.relation},u(i.relation),9,Ee)]))),256))])])]),h(e("div",Ie,[l[4]||(l[4]=e("div",{style:{"margin-right":"10px"}},"页数",-1)),h(e("select",{class:"pageTurn","onUpdate:modelValue":l[1]||(l[1]=i=>y.value=i)},[(r(!0),p(b,null,$(v.value,(i,E)=>(r(),p("option",{value:E},u(E+1),9,Fe))),256))],512),[[N,y.value]])],512),[[w,v.value.length>1]])]))}},Ae=S(Te,[["__scopeId","data-v-c9fb2cc9"]]),Se={class:"panels"},Be=["onClick"],Ke={__name:"Knowledge",setup(F){const c=I().proxy.screen,m=[{name:"使用说明",component:W},{name:"用户知识库",component:ve},{name:"内置知识库",component:Ae}],n=K(m[1]),a=K(!1);return(y,v)=>(r(),p("div",{class:L(["area",k(c).type])},[h(e("img",{src:Y,class:"floatBtn buttonEffect",onClick:v[0]||(v[0]=_=>a.value=!a.value)},null,512),[[w,k(c).type==="ver"]]),h(e("div",Se,[(r(),p(b,null,$(m,_=>e("div",{class:L(["panel","buttonEffect",{active:n.value.name===_.name}]),onClick:g=>(n.value=_,a.value=!1)},u(_.name),11,Be)),64))],512),[[w,k(c).type==="hor"||a.value]]),(r(),D(J,{class:"content"},[(r(),D(H(n.value.component)))],1024))],2))}},Ve=S(Ke,[["__scopeId","data-v-cd648e60"]]);export{Ve as default};
