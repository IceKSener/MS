import{g as E,h as M,c as u,o as r,j as K,u as C,_ as D,e as y,r as z,s as q,i as e,w as f,l as B,x as H,y as G,z as N,v as k,A as R,F as I,k as F,t as _,B as Z,C as S,D as L,E as V,m as J,n as j,G as Q,K as W}from"./index-DLkJZCO8.js";const X=`# 知识库上传说明\r
\r
知识库文件为jsonl格式和后缀，每行为包含\`id\`, \`label\`, \`name\`, \`desc\`, \`relation\`字段的json数据\r
\r
|字段|含义|必须|\r
|-|-|-|\r
|id|该条数据的id|×|\r
|label|该条数据的id|〇|\r
|name|该条数据的id|〇|\r
|desc|该条数据的id|〇|\r
|relation|该条数据的id|〇|\r
`,ee={__name:"Usage",setup(A){const d=E().proxy.config.settings;return(h,l)=>{const c=M("Markdown");return r(),u("div",null,[K(c,{class:"md",md:C(X),theme:C(d).theme},null,8,["md","theme"])])}}},te={class:"panelArea"},se={class:"funcs"},ne={class:"funcSearch"},le={class:"items"},oe={class:"loading"},ae={border:"1",cellspacing:"0"},ie=["title"],re=["title"],de=["title"],ce=["title"],ue=["title"],pe={style:{"max-width":"55px"}},me=["onClick"],_e={class:"pages"},he=["value"],P=30,ve={__name:"Library",setup(A){const d=E().proxy.F,h=E().proxy.config.settings,l=y(),c=y([]),i=z({items:c,ready:!1});async function v(){i.ready=!1;let n=await d.myFetchApi("/knowledge/get_user_knowledges",{expectCodes:[200],errorText:"用户知识库获取失败，请刷新重试"});n&&(c.value=n.data,i.items===c&&(i.ready=!0)),i.ready=!0}v();const p=y(0),g=q(()=>{let n=[];for(let t=0;t<i.items.length;t+=P)n.push(i.items.slice(t,t+P));return n});function b(){const n=l.value;n.removeEventListener("change",b);let t=[],x=[];for(let o of n.files){window.file=o;let w=new FormData;w.append("file",o),x.push(d.myFetchApi("/knowledge/upload_jsonl_knowledges",{expectCodes:[200,201],onError(O,Y){t.push(o.name+" : "+O),console.error(Y)}},{data:w}))}Promise.all(x).then(()=>{t.length>0?S.emit("dialog",{text:`文件上传失败:
`+t.join(`
`)}):S.emit("dialog",{text:`上传成功:
`+t.join(`
`)}),n.files.length>t.length&&v()})}function m(){const n=l.value;n.value="",n.addEventListener("change",b),n.click()}const s=y(""),$=y([]);async function a(){let n=s.value.trim();if(n){i.ready=!1;try{let t=await d.myFetchApi("/knowledge/query_user_knowledge?part_name="+n,{expectCodes:[200],errorText:`"${n}" 查询失败`});t&&($.value=t.data,i.items=$)}finally{i.ready=!0}}else i.items=c}function T(n){function t(){d.myFetchApi("/knowledge/del_knowledge/"+n.id,{expectCodes:[200],errorText:`${n.name}删除失败`},{method:"DELETE"}).then(x=>{x&&(v(),i.items===$&&a())})}h.comfBefDelKnow?S.emit("dialog",{text:"确定删除该条知识吗？",onYes(x){h.comfBefDelKnow=x,t()},checkText:"每次删除都提示确认",checkVal:!0,type:"yes_no"}):t()}return(n,t)=>{const x=M("Markdown");return r(),u("div",te,[e("div",se,[e("input",{type:"file",style:{display:"none"},accept:".jsonl",multiple:"",ref_key:"fileSelector",ref:l},null,512),e("div",{class:"func buttonEffect",onClick:m},t[2]||(t[2]=[e("img",{src:H,alt:"+"},null,-1),B(" 上传文件")])),e("div",ne,[e("div",{class:"text buttonEffect",onClick:a},"知识查询"),f(e("input",{class:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>s.value=o),onKeyup:N(a,["enter"]),placeholder:"留空列出所有数据"},null,544),[[G,s.value]])])]),e("div",le,[f(e("div",oe,t[3]||(t[3]=[e("img",{class:"autoInvert",src:R,alt:""},null,-1),B(" 加载中 ")]),512),[[k,!i.ready]]),e("table",ae,[t[4]||(t[4]=e("thead",{style:{position:"sticky",top:"0","background-color":"var(--bgColor)","z-index":"5"}},[e("tr",null,[e("th",{width:"80px"},"id"),e("th",{width:"120px"},"label"),e("th",{width:"120px"},"name"),e("th",null,"desc"),e("th",{width:"120px"},"relation"),e("th",{width:"55px"},"操作")])],-1)),e("tbody",null,[(r(!0),u(I,null,F(g.value[p.value],o=>(r(),u("tr",null,[e("td",{style:{"max-width":"80px"},title:o.id},_(o.id),9,ie),e("td",{style:{"max-width":"120px"},title:o.label},_(o.label),9,re),e("td",{style:{"max-width":"120px"},title:o.name},_(o.name),9,de),e("td",{style:{"max-width":"0"},title:o.desc},[K(x,{style:{"max-height":"100px"},md:o.desc},null,8,["md"])],8,ce),e("td",{style:{"max-width":"120px"},title:o.relation},_(o.relation),9,ue),e("td",pe,[e("div",{class:"delBtn buttonEffect",onClick:w=>T(o)},"删除",8,me)])]))),256))])])]),f(e("div",_e,[t[5]||(t[5]=e("div",{style:{"margin-right":"10px"}},"页数",-1)),f(e("select",{class:"pageTurn","onUpdate:modelValue":t[1]||(t[1]=o=>p.value=o)},[(r(!0),u(I,null,F(g.value,(o,w)=>(r(),u("option",{value:w},_(w+1),9,he))),256))],512),[[Z,p.value]])],512),[[k,g.value.length>1]])])}}},fe=D(ve,[["__scopeId","data-v-d56406a2"]]),ye={class:"panelArea"},xe={class:"funcs"},ge={class:"funcSearch"},we={class:"items"},ke={class:"loading"},be={border:"1",cellspacing:"0"},$e=["title"],Ce=["title"],Ee=["title"],Ie=["title"],Fe=["title"],Te={class:"pages"},Ae=["value"],U=30,Se={__name:"LibraryInter",setup(A){const d=E().proxy.F,h=y([]),l=z({items:h,ready:!1});window.currShow=l;async function c(){l.ready=!1;let m=await d.myFetchApi("/knowledge/get_inner_knowledges",{expectCodes:[200],errorText:"内部知识库获取失败，请刷新重试"});m&&(h.value=m.data),l.ready=!0}c();const i=y(0),v=q(()=>{let m=[];console.log(l);for(let s=0;s<l.items.length;s+=U)m.push(l.items.slice(s,s+U));return m}),p=y(""),g=y([]);async function b(){let m=p.value.trim();if(m){l.ready=!1;try{let s=await d.myFetchApi("/knowledge/query_inner_knowledge?part_name="+m,{expectCodes:[200],errorText:`"${m}" 查询失败`});s&&(g.value=s.data,l.items=g)}finally{l.ready=!0}}else l.items=h}return(m,s)=>{const $=M("Markdown");return r(),u("div",ye,[e("div",xe,[e("div",ge,[e("div",{class:"text buttonEffect",onClick:b},"知识查询"),f(e("input",{class:"input",type:"text","onUpdate:modelValue":s[0]||(s[0]=a=>p.value=a),onKeyup:N(b,["enter"]),placeholder:"留空列出所有数据"},null,544),[[G,p.value]])])]),e("div",we,[f(e("div",ke,s[2]||(s[2]=[e("img",{class:"autoInvert",src:R,alt:""},null,-1),B(" 加载中 ")]),512),[[k,!l.ready]]),e("table",be,[s[3]||(s[3]=e("thead",{style:{position:"sticky",top:"0","background-color":"var(--bgColor)","z-index":"5"}},[e("tr",null,[e("th",{width:"80px"},"id"),e("th",{width:"120px"},"label"),e("th",{width:"120px"},"name"),e("th",null,"desc"),e("th",{width:"120px"},"relation")])],-1)),e("tbody",null,[(r(!0),u(I,null,F(v.value[i.value],a=>(r(),u("tr",null,[e("td",{style:{"max-width":"80px"},title:a.id},_(a.id),9,$e),e("td",{style:{"max-width":"120px"},title:a.label},_(a.label),9,Ce),e("td",{style:{"max-width":"120px"},title:a.name},_(a.name),9,Ee),e("td",{style:{"max-width":"0"},title:a.desc},[K($,{style:{"max-height":"100px"},md:a.desc},null,8,["md"])],8,Ie),e("td",{style:{"max-width":"120px"},title:a.relation},_(a.relation),9,Fe)]))),256))])])]),f(e("div",Te,[s[4]||(s[4]=e("div",{style:{"margin-right":"10px"}},"页数",-1)),f(e("select",{class:"pageTurn","onUpdate:modelValue":s[1]||(s[1]=a=>i.value=a)},[(r(!0),u(I,null,F(v.value,(a,T)=>(r(),u("option",{value:T},_(T+1),9,Ae))),256))],512),[[Z,i.value]])],512),[[k,v.value.length>1]])])}}},Be=D(Se,[["__scopeId","data-v-07f54fc1"]]),Me={class:"panels"},Ke=["onClick"],De={__name:"Knowledge",setup(A){const d=E().proxy.screen,h=[{name:"使用说明",component:ee},{name:"用户知识库",component:fe},{name:"内置知识库",component:Be}],l=L(h[1]),c=L(!1);return(i,v)=>(r(),u("div",{class:j(["area",C(d).type])},[f(e("img",{src:J,class:"floatBtn buttonEffect",onClick:v[0]||(v[0]=p=>c.value=!c.value)},null,512),[[k,C(d).type==="ver"]]),f(e("div",Me,[(r(),u(I,null,F(h,p=>e("div",{class:j(["panel","buttonEffect",{active:l.value.name===p.name}]),onClick:g=>(l.value=p,c.value=!1)},_(p.name),11,Ke)),64))],512),[[k,C(d).type==="hor"||c.value]]),(r(),V(W,{class:"content"},[(r(),V(Q(l.value.component)))],1024))],2))}},Ve=D(De,[["__scopeId","data-v-cd648e60"]]);export{Ve as default};
