import{g as C,h as Z,c as p,o as r,j as O,u as $,_ as S,e as y,r as M,s as P,i as e,w as f,l as A,x as Y,y as U,z as q,v as k,A as G,F as E,k as I,t as u,B as N,C as T,D as K,E as D,m as H,n as L,G as J,K as Q}from"./index-DkTJCDro.js";const W=`# 知识库上传说明\r
\r
知识库文件为jsonl格式和后缀，每行为包含\`id\`, \`label\`, \`name\`, \`desc\`, \`relation\`字段的json数据\r
\r
|字段|含义|必须|\r
|-|-|-|\r
|id|该条数据的id|×|\r
|label|该条数据的id|〇|\r
|name|该条数据的id|〇|\r
|desc|该条数据的id|〇|\r
|relation|该条数据的id|〇|\r
`,X={__name:"Usage",setup(F){const c=C().proxy.config.settings;return(v,a)=>{const d=Z("Markdown");return r(),p("div",null,[O(d,{class:"md",md:$(W),theme:$(c).theme},null,8,["md","theme"])])}}},ee={class:"panelArea"},te={class:"funcs"},se={class:"funcSearch"},le={class:"items"},ne={class:"loading"},ae={border:"1",cellspacing:"0"},oe=["title"],ie=["title"],re=["title"],de=["title"],ce=["title"],ue={style:{"max-width":"55px"}},pe=["onClick"],me={class:"pages"},_e=["value"],V=30,ve={__name:"Library",setup(F){const c=C().proxy.F,v=C().proxy.config.settings,a=y(),d=y([]);for(let s=0;s<100;++s)d.value.push({id:s,name:s+""+s});const i=M({items:d.value,ready:!1});async function h(){i.ready=!1;let s=await c.myFetchApi("/knowledge/get_user_knowledges",{expectCodes:[200],errorText:"用户知识库获取失败，请刷新重试"});s&&(d.value=s.data,i.items===d.value&&(i.ready=!0)),i.ready=!0}h();const m=y(0),x=P(()=>{let s=[];for(let t=0;t<i.items.length;t+=V)s.push(i.items.slice(t,t+V));return s});function b(){const s=a.value;s.removeEventListener("change",b);let t=[],l=[];for(let g of s.files){console.log(g);let B=new FormData;B.append("file",g),l.push(c.myFetchApi("/knowledge/upload_jsonl_knowledges",{expectCodes:[200,201],onError(Le,z){t.push(g.name),console.error(z)}},{data:B}))}Promise.all(l).then(()=>{t.length>=0?T.emit("dialog",{text:`文件上传失败:
`+t.join(`
`)}):T.emit("dialog",{text:`上传成功:
`+t.join(`
`)}),s.files.length>t.length&&h()})}function _(){const s=a.value;s.value="",s.addEventListener("change",b),s.click()}const n=y(""),o=y([]);async function w(){let s=n.value.trim();if(s){i.ready=!1;try{let t=await c.myFetchApi("/knowledge/query_user_knowledge?part_name="+s,{expectCodes:[200],errorText:`"${s}" 查询失败`});t&&(o.value=t.data,i.items=o.value)}finally{i.ready=!0}}else i.items=d.value}function R(s){function t(){c.myFetchApi("/knowledge/del_knowledge/"+s.id,{expectCodes:[200],errorText:`${s.name}删除失败`},{method:"DELETE"}).then(l=>{l&&(h(),i.items===o.value&&w())})}v.comfBefDelKnow?T.emit("dialog",{text:"确定删除该条知识吗？",onYes(l){v.comfBefDelKnow=l,t()},checkText:"每次删除都提示确认",checkVal:!0,type:"yes_no"}):t()}return(s,t)=>(r(),p("div",ee,[e("div",te,[e("input",{type:"file",style:{display:"none"},accept:".jsonl",multiple:"",ref_key:"fileSelector",ref:a},null,512),e("div",{class:"func buttonEffect",onClick:_},t[2]||(t[2]=[e("img",{src:Y,alt:"+"},null,-1),A(" 上传文件")])),e("div",se,[e("div",{class:"text buttonEffect",onClick:w},"知识查询"),f(e("input",{class:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l),onKeyup:q(w,["enter"])},null,544),[[U,n.value]])])]),e("div",le,[f(e("div",ne,t[3]||(t[3]=[e("img",{class:"autoInvert",src:G,alt:""},null,-1),A(" 加载中 ")]),512),[[k,!i.ready]]),e("table",ae,[t[4]||(t[4]=e("thead",{style:{position:"sticky",top:"0","background-color":"var(--bgColor)"}},[e("tr",null,[e("th",{width:"80px"},"id"),e("th",{width:"120px"},"label"),e("th",{width:"120px"},"name"),e("th",null,"desc"),e("th",{width:"120px"},"relation"),e("th",{width:"55px"},"操作")])],-1)),e("tbody",null,[(r(!0),p(E,null,I(x.value[m.value],l=>(r(),p("tr",null,[e("td",{style:{"max-width":"80px"},title:l.id},u(l.id),9,oe),e("td",{style:{"max-width":"120px"},title:l.label},u(l.label),9,ie),e("td",{style:{"max-width":"120px"},title:l.name},u(l.name),9,re),e("td",{style:{"max-width":"0"},title:l.desc},u(l.desc),9,de),e("td",{style:{"max-width":"120px"},title:l.relation},u(l.relation),9,ce),e("td",ue,[e("div",{class:"delBtn buttonEffect",onClick:g=>R(l)},"删除",8,pe)])]))),256))])])]),f(e("div",me,[t[5]||(t[5]=e("div",{style:{"margin-right":"10px"}},"页数",-1)),f(e("select",{class:"pageTurn","onUpdate:modelValue":t[1]||(t[1]=l=>m.value=l)},[(r(!0),p(E,null,I(x.value,(l,g)=>(r(),p("option",{value:g},u(g+1),9,_e))),256))],512),[[N,m.value]])],512),[[k,x.value.length>1]])]))}},he=S(ve,[["__scopeId","data-v-e9b7bd65"]]),fe={class:"panelArea"},ye={class:"funcs"},xe={class:"funcSearch"},ge={class:"items"},we={class:"loading"},ke={border:"1",cellspacing:"0"},be=["title"],$e=["title"],Ce=["title"],Ee=["title"],Ie=["title"],Fe={class:"pages"},Te=["value"],j=30,Ae={__name:"LibraryInter",setup(F){const c=C().proxy.F,v=y([]),a=M({items:v.value,ready:!1});async function d(){a.ready=!1;let _=await c.myFetchApi("/knowledge/get_inner_knowledges",{expectCodes:[200],errorText:"内部知识库获取失败，请刷新重试"});_&&(v.value=_.data,a.items===v.value&&(a.ready=!0)),a.ready=!0}d();const i=y(0),h=P(()=>{let _=[];for(let n=0;n<a.items.length;n+=j)_.push(a.items.slice(n,n+j));return _}),m=y(""),x=y([]);async function b(){let _=m.value.trim();if(_){a.ready=!1;try{let n=await c.myFetchApi("/knowledge/query_inner_knowledge?part_name="+_,{expectCodes:[200],errorText:`"${_}" 查询失败`});n&&(x.value=n.data,a.items=x.value)}finally{a.ready=!0}}else a.items=v.value}return(_,n)=>(r(),p("div",fe,[e("div",ye,[e("div",xe,[e("div",{class:"text buttonEffect",onClick:b},"知识查询"),f(e("input",{class:"input",type:"text","onUpdate:modelValue":n[0]||(n[0]=o=>m.value=o),onKeyup:q(b,["enter"])},null,544),[[U,m.value]])])]),e("div",ge,[f(e("div",we,n[2]||(n[2]=[e("img",{class:"autoInvert",src:G,alt:""},null,-1),A(" 加载中 ")]),512),[[k,!a.ready]]),e("table",ke,[n[3]||(n[3]=e("thead",{style:{position:"sticky",top:"0","background-color":"var(--bgColor)"}},[e("tr",null,[e("th",{width:"80px"},"id"),e("th",{width:"120px"},"label"),e("th",{width:"120px"},"name"),e("th",null,"desc"),e("th",{width:"120px"},"relation")])],-1)),e("tbody",null,[(r(!0),p(E,null,I(h.value[i.value],o=>(r(),p("tr",null,[e("td",{style:{"max-width":"80px"},title:o.id},u(o.id),9,be),e("td",{style:{"max-width":"120px"},title:o.label},u(o.label),9,$e),e("td",{style:{"max-width":"120px"},title:o.name},u(o.name),9,Ce),e("td",{style:{"max-width":"0"},title:o.desc},u(o.desc),9,Ee),e("td",{style:{"max-width":"120px"},title:o.relation},u(o.relation),9,Ie)]))),256))])])]),f(e("div",Fe,[n[4]||(n[4]=e("div",{style:{"margin-right":"10px"}},"页数",-1)),f(e("select",{class:"pageTurn","onUpdate:modelValue":n[1]||(n[1]=o=>i.value=o)},[(r(!0),p(E,null,I(h.value,(o,w)=>(r(),p("option",{value:w},u(w+1),9,Te))),256))],512),[[N,i.value]])],512),[[k,h.value.length>1]])]))}},Se=S(Ae,[["__scopeId","data-v-c9fb2cc9"]]),Be={class:"panels"},Ke=["onClick"],De={__name:"Knowledge",setup(F){const c=C().proxy.screen,v=[{name:"使用说明",component:X},{name:"用户知识库",component:he},{name:"内置知识库",component:Se}],a=K(v[1]),d=K(!1);return(i,h)=>(r(),p("div",{class:L(["area",$(c).type])},[f(e("img",{src:H,class:"floatBtn buttonEffect",onClick:h[0]||(h[0]=m=>d.value=!d.value)},null,512),[[k,$(c).type==="ver"]]),f(e("div",Be,[(r(),p(E,null,I(v,m=>e("div",{class:L(["panel","buttonEffect",{active:a.value.name===m.name}]),onClick:x=>(a.value=m,d.value=!1)},u(m.name),11,Ke)),64))],512),[[k,$(c).type==="hor"||d.value]]),(r(),D(Q,{class:"content"},[(r(),D(J(a.value.component)))],1024))],2))}},je=S(De,[["__scopeId","data-v-cd648e60"]]);export{je as default};
