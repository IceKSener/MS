import{g as I,h as D,c as u,o as d,j as M,u as E,_ as K,e as g,r as z,s as w,x as q,i as e,w as f,l as B,y as H,z as G,A as N,v as $,B as R,F,k as S,t as v,C as Z,D as L,E as V,m as J,n as j,G as Q,K as W}from"./index-D5JQlgOv.js";const X=`# 知识库上传说明\r
\r
知识库文件为jsonl格式和后缀，每行为包含\`id\`, \`label\`, \`name\`, \`desc\`, \`relation\`字段的json数据\r
\r
|字段|含义|必须|\r
|-|-|-|\r
|id|该条数据的id|×|\r
|label|该条数据的id|〇|\r
|name|该条数据的id|〇|\r
|desc|该条数据的id|〇|\r
|relation|该条数据的id|〇|\r
`,ee={__name:"Usage",setup(A){const c=I().proxy.config.settings;return(_,l)=>{const r=D("Markdown");return d(),u("div",null,[M(r,{class:"md",md:E(X),theme:E(c).theme},null,8,["md","theme"])])}}},te={class:"panelArea"},se={class:"funcs"},ne={class:"funcSearch"},le={class:"items"},oe={class:"loading"},ae={border:"1",cellspacing:"0"},ie=["title"],re=["title"],de=["title"],ce=["title"],ue=["title"],pe={style:{"max-width":"55px"}},me=["onClick"],_e={class:"pages"},he=["value"],P=30,ve={__name:"Library",setup(A){const c=I().proxy.F,_=I().proxy.config.settings,l=g(),r=g([]),i=z({items:r,ready:!1});async function h(){i.ready=!1;let n=await c.myFetchApi("/knowledge/get_user_knowledges",{expectCodes:[200],errorText:"用户知识库获取失败，请刷新重试"});n&&(r.value=n.data,i.items===r&&(i.ready=!0)),i.ready=!0}h(),w.on("loginSuccess",h);const p=g(0),y=q(()=>{let n=[];for(let t=0;t<i.items.length;t+=P)n.push(i.items.slice(t,t+P));return n});w.on("logoutDone",()=>{r.value.length=k.value.length=0});function C(){const n=l.value;n.removeEventListener("change",C);let t=[],x=[];for(let o of n.files){window.file=o;let b=new FormData;b.append("file",o),x.push(c.myFetchApi("/knowledge/upload_jsonl_knowledges",{expectCodes:[200,201],onError(O,Y){t.push(o.name+" : "+O),console.error(Y)}},{data:b}))}Promise.all(x).then(()=>{t.length>0?w.emit("dialog",{text:`文件上传失败:
`+t.join(`
`)}):w.emit("dialog",{text:`上传成功:
`+t.join(`
`)}),n.files.length>t.length&&h()})}function m(){const n=l.value;n.value="",n.addEventListener("change",C),n.click()}const s=g(""),k=g([]);async function a(){let n=s.value.trim();if(n){i.ready=!1;try{let t=await c.myFetchApi("/knowledge/query_user_knowledge?part_name="+n,{expectCodes:[200],errorText:`"${n}" 查询失败`});t&&(k.value=t.data,i.items=k)}finally{i.ready=!0}}else i.items=r}function T(n){function t(){c.myFetchApi("/knowledge/del_knowledge/"+n.id,{expectCodes:[200],errorText:`${n.name}删除失败`},{method:"DELETE"}).then(x=>{x&&(h(),i.items===k&&a())})}_.comfBefDelKnow?w.emit("dialog",{text:"确定删除该条知识吗？",onYes(x){_.comfBefDelKnow=x,t()},checkText:"每次删除都提示确认",checkVal:!0,type:"yes_no"}):t()}return(n,t)=>{const x=D("Markdown");return d(),u("div",te,[e("div",se,[e("input",{type:"file",style:{display:"none"},accept:".jsonl",multiple:"",ref_key:"fileSelector",ref:l},null,512),e("div",{class:"func buttonEffect",onClick:m},t[2]||(t[2]=[e("img",{src:H,alt:"+"},null,-1),B(" 上传文件")])),e("div",ne,[e("div",{class:"text buttonEffect",onClick:a},"知识查询"),f(e("input",{class:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>s.value=o),onKeyup:N(a,["enter"]),placeholder:"留空列出所有数据"},null,544),[[G,s.value]])])]),e("div",le,[f(e("div",oe,t[3]||(t[3]=[e("img",{class:"autoInvert",src:R,alt:""},null,-1),B(" 加载中 ")]),512),[[$,!i.ready]]),e("table",ae,[t[4]||(t[4]=e("thead",{style:{position:"sticky",top:"0","background-color":"var(--bgColor)","z-index":"5"}},[e("tr",null,[e("th",{width:"80px"},"id"),e("th",{width:"120px"},"label"),e("th",{width:"120px"},"name"),e("th",null,"desc"),e("th",{width:"120px"},"relation"),e("th",{width:"55px"},"操作")])],-1)),e("tbody",null,[(d(!0),u(F,null,S(y.value[p.value],o=>(d(),u("tr",null,[e("td",{style:{"max-width":"80px"},title:o.id},v(o.id),9,ie),e("td",{style:{"max-width":"120px"},title:o.label},v(o.label),9,re),e("td",{style:{"max-width":"120px"},title:o.name},v(o.name),9,de),e("td",{style:{"max-width":"0"},title:o.desc},[M(x,{style:{"max-height":"100px"},md:o.desc},null,8,["md"])],8,ce),e("td",{style:{"max-width":"120px"},title:o.relation},v(o.relation),9,ue),e("td",pe,[e("div",{class:"delBtn buttonEffect",onClick:b=>T(o)},"删除",8,me)])]))),256))])])]),f(e("div",_e,[t[5]||(t[5]=e("div",{style:{"margin-right":"10px"}},"页数",-1)),f(e("select",{class:"pageTurn","onUpdate:modelValue":t[1]||(t[1]=o=>p.value=o)},[(d(!0),u(F,null,S(y.value,(o,b)=>(d(),u("option",{value:b},v(b+1),9,he))),256))],512),[[Z,p.value]])],512),[[$,y.value.length>1]])])}}},fe=K(ve,[["__scopeId","data-v-7a49457c"]]),ge={class:"panelArea"},ye={class:"funcs"},xe={class:"funcSearch"},we={class:"items"},ke={class:"loading"},be={border:"1",cellspacing:"0"},$e=["title"],Ce=["title"],Ee=["title"],Ie=["title"],Fe=["title"],Se={class:"pages"},Te=["value"],U=30,Ae={__name:"LibraryInter",setup(A){const c=I().proxy.F,_=g([]),l=z({items:_,ready:!1});window.currShow=l;async function r(){l.ready=!1;let m=await c.myFetchApi("/knowledge/get_inner_knowledges",{expectCodes:[200],errorText:"内部知识库获取失败，请刷新重试"});m&&(_.value=m.data),l.ready=!0}r(),w.on("loginSuccess",r);const i=g(0),h=q(()=>{let m=[];console.log(l);for(let s=0;s<l.items.length;s+=U)m.push(l.items.slice(s,s+U));return m}),p=g(""),y=g([]);w.on("logoutDone",()=>{_.value.length=y.value.length=0});async function C(){let m=p.value.trim();if(m){l.ready=!1;try{let s=await c.myFetchApi("/knowledge/query_inner_knowledge?part_name="+m,{expectCodes:[200],errorText:`"${m}" 查询失败`});s&&(y.value=s.data,l.items=y)}finally{l.ready=!0}}else l.items=_}return(m,s)=>{const k=D("Markdown");return d(),u("div",ge,[e("div",ye,[e("div",xe,[e("div",{class:"text buttonEffect",onClick:C},"知识查询"),f(e("input",{class:"input",type:"text","onUpdate:modelValue":s[0]||(s[0]=a=>p.value=a),onKeyup:N(C,["enter"]),placeholder:"留空列出所有数据"},null,544),[[G,p.value]])])]),e("div",we,[f(e("div",ke,s[2]||(s[2]=[e("img",{class:"autoInvert",src:R,alt:""},null,-1),B(" 加载中 ")]),512),[[$,!l.ready]]),e("table",be,[s[3]||(s[3]=e("thead",{style:{position:"sticky",top:"0","background-color":"var(--bgColor)","z-index":"5"}},[e("tr",null,[e("th",{width:"80px"},"id"),e("th",{width:"120px"},"label"),e("th",{width:"120px"},"name"),e("th",null,"desc"),e("th",{width:"120px"},"relation")])],-1)),e("tbody",null,[(d(!0),u(F,null,S(h.value[i.value],a=>(d(),u("tr",null,[e("td",{style:{"max-width":"80px"},title:a.id},v(a.id),9,$e),e("td",{style:{"max-width":"120px"},title:a.label},v(a.label),9,Ce),e("td",{style:{"max-width":"120px"},title:a.name},v(a.name),9,Ee),e("td",{style:{"max-width":"0"},title:a.desc},[M(k,{style:{"max-height":"100px"},md:a.desc},null,8,["md"])],8,Ie),e("td",{style:{"max-width":"120px"},title:a.relation},v(a.relation),9,Fe)]))),256))])])]),f(e("div",Se,[s[4]||(s[4]=e("div",{style:{"margin-right":"10px"}},"页数",-1)),f(e("select",{class:"pageTurn","onUpdate:modelValue":s[1]||(s[1]=a=>i.value=a)},[(d(!0),u(F,null,S(h.value,(a,T)=>(d(),u("option",{value:T},v(T+1),9,Te))),256))],512),[[Z,i.value]])],512),[[$,h.value.length>1]])])}}},Be=K(Ae,[["__scopeId","data-v-6819af29"]]),De={class:"panels"},Me=["onClick"],Ke={__name:"Knowledge",setup(A){const c=I().proxy.screen,_=[{name:"使用说明",component:ee},{name:"用户知识库",component:fe},{name:"内置知识库",component:Be}],l=L(_[1]),r=L(!1);return(i,h)=>(d(),u("div",{class:j(["area",E(c).type])},[f(e("img",{src:J,class:"floatBtn buttonEffect",onClick:h[0]||(h[0]=p=>r.value=!r.value)},null,512),[[$,E(c).type==="ver"]]),f(e("div",De,[(d(),u(F,null,S(_,p=>e("div",{class:j(["panel","buttonEffect",{active:l.value.name===p.name}]),onClick:y=>(l.value=p,r.value=!1)},v(p.name),11,Me)),64))],512),[[$,E(c).type==="hor"||r.value]]),(d(),V(W,{class:"content"},[(d(),V(Q(l.value.component)))],1024))],2))}},Ve=K(Ke,[["__scopeId","data-v-cd648e60"]]);export{Ve as default};
