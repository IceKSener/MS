import{g as E,h as L,c as i,o,j as V,u as w,_ as C,e as m,r as M,s as N,i as e,l as P,x as D,w as $,y as U,z as q,F as b,k,t as p,A as z,B as g,a as G,C as R,D as Y,E as A,n as B,G as Z,K as H}from"./index-BScTtCZX.js";const J=`# 知识库上传说明\r
\r
知识库文件为jsonl格式和后缀，每行为包含\`id\`, \`label\`, \`name\`, \`desc\`, \`relation\`字段的json数据\r
\r
|字段|含义|必须|\r
|-|-|-|\r
|id|该条数据的id|×|\r
|label|该条数据的id|〇|\r
|name|该条数据的id|〇|\r
|desc|该条数据的id|〇|\r
|relation|该条数据的id|〇|\r
`,O={__name:"Usage",setup(v){const l=E().proxy.config.settings;return(d,c)=>{const n=L("Markdown");return o(),i("div",null,[V(n,{class:"md",md:w(J),theme:w(l).theme},null,8,["md","theme"])])}}},Q={class:"panelArea"},W={class:"funcs"},X={class:"funcSearch"},ee={class:"items"},te={border:"1",cellspacing:"0"},ae=["title"],se=["title"],ne=["title"],le=["title"],oe=["title"],ce={style:{"max-width":"55px"}},ie=["onClick"],de={class:"pages"},re=["value"],S=30,ue={__name:"Library",setup(v){const l=E().proxy.F,d=m(),c=m([]),n=M({items:c.value,ready:!1});async function _(){n.ready=!1;let s=await l.myFetchApi("/knowledge/get_user_knowledges",{expectCodes:[200],errorText:"知识库获取失败，请刷新重试"});s&&(c.value=s.data,n.items===c.value&&(n.ready=!0)),n.ready=!0}_();const r=m(0),f=N(()=>{let s=[];for(let t=0;t<n.items.length;t+=S)s.push(n.items.slice(t,t+S));return s});function F(){const s=d.value;s.removeEventListener("change",F);let t=[],a=[];for(let u of s.files){console.log(u);let I=new FormData;I.append("file",u),a.push(l.myFetchApi("/knowledge/upload_jsonl_knowledges",{expectCodes:[200,201],onError(ge,j){t.push(u.name),console.error(j)}},{data:I}))}Promise.all(a).then(()=>{t.length>=0?g.emit("dialog",{text:`文件上传失败:
`+t.join(`
`)}):g.emit("dialog",{text:`上传成功:
`+t.join(`
`)}),s.files.length>t.length&&_()})}function K(){const s=d.value;s.value="",s.addEventListener("change",F),s.click()}const h=m(""),x=m([]);async function y(){let s=h.value.trim();if(s){n.ready=!1;try{let t=await l.myFetchApi("/knowledge/query_user_knowledge?part_name="+s,{expectCodes:[200],errorText:`"${s}" 查询失败`});t&&(x.value=t.data,n.items=x.value)}finally{n.ready=!0}}else n.items=c.value}function T(s){function t(){l.myFetchApi("/knowledge/del_knowledge/"+s.id,{expectCodes:[200],errorText:`${s.name}删除失败`},{method:"DELETE"}).then(a=>{a&&(_(),n.items===x.value&&y())})}settings.comfBefDelKnow?g.emit("dialog",{text:"确定删除该条知识吗？",onYes(a){settings.comfBefDelKnow=a,t()},checkText:"每次删除都提示确认",checkVal:!0,type:"yes_no"}):t()}return(s,t)=>(o(),i("div",Q,[e("div",W,[e("input",{type:"file",style:{display:"none"},accept:".jsonl",multiple:"",ref_key:"fileSelector",ref:d},null,512),e("div",{class:"func buttonEffect",onClick:K},t[2]||(t[2]=[e("img",{src:D,alt:"+"},null,-1),P(" 上传文件")])),e("div",X,[e("div",{class:"text buttonEffect",onClick:y},"知识查询"),$(e("input",{class:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),onKeyup:q(y,["enter"])},null,544),[[U,h.value]])])]),e("div",ee,[e("table",te,[t[3]||(t[3]=e("thead",{style:{position:"sticky",top:"0","background-color":"var(--bgColor)"}},[e("tr",null,[e("th",{width:"80px"},"id"),e("th",{width:"120px"},"label"),e("th",{width:"120px"},"name"),e("th",null,"desc"),e("th",{width:"120px"},"relation"),e("th",{width:"55px"},"操作")])],-1)),e("tbody",null,[(o(!0),i(b,null,k(f.value[r.value],a=>(o(),i("tr",null,[e("td",{style:{"max-width":"80px"},title:a.id},p(a.id),9,ae),e("td",{style:{"max-width":"120px"},title:a.label},p(a.label),9,se),e("td",{style:{"max-width":"120px"},title:a.name},p(a.name),9,ne),e("td",{style:{"max-width":"0"},title:a.desc},p(a.desc),9,le),e("td",{style:{"max-width":"120px"},title:a.relation},p(a.relation),9,oe),e("td",ce,[e("div",{class:"delBtn buttonEffect",onClick:u=>T(a)},"删除",8,ie)])]))),256))])])]),e("div",de,[$(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>r.value=a)},[(o(!0),i(b,null,k(f.value,(a,u)=>(o(),i("option",{value:u},p(u+1),9,re))),256))],512),[[z,r.value]])])]))}},pe=C(ue,[["__scopeId","data-v-d07e5510"]]),me={},_e={class:"panelArea"};function ve(v,l){return o(),i("div",_e,l[0]||(l[0]=[G('<div class="funcs" data-v-bdcaa5a3><div class="func buttonEffect" data-v-bdcaa5a3><img src="'+D+'" alt="+" data-v-bdcaa5a3> 上传文件</div><div class="func buttonEffect" data-v-bdcaa5a3><img src="'+R+'" alt="+" data-v-bdcaa5a3> 添加知识</div><div class="funcSearch" data-v-bdcaa5a3><div class="text buttonEffect" data-v-bdcaa5a3>知识查询</div><input class="input" type="text" data-v-bdcaa5a3></div></div>',1)]))}const fe=C(me,[["render",ve],["__scopeId","data-v-bdcaa5a3"]]),he={class:"panels"},xe=["onClick"],ye={__name:"Knowledge",setup(v){const l=E().proxy.screen,d=[{name:"使用说明",component:O},{name:"用户知识库",component:pe},{name:"内置知识库",component:fe}],c=Y(d[1]);return(n,_)=>(o(),i("div",{class:B(["area",w(l).type])},[e("div",he,[(o(),i(b,null,k(d,r=>e("div",{class:B(["panel","buttonEffect",{active:c.value.name===r.name}]),onClick:f=>c.value=r},p(r.name),11,xe)),64))]),(o(),A(H,{class:"content"},[(o(),A(Z(c.value.component)))],1024))],2))}},be=C(ye,[["__scopeId","data-v-aa84b1c9"]]);export{be as default};
