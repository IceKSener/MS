import{_ as O,g as b,e as r,r as _,I as A,c as k,o as C,j as P,J as N,H as W,n as f,u as l,i as t,t as D,s as a,L as R,w as g,v as $,z as U,T as X}from"./index-D5JQlgOv.js";const Y={class:"info"},H=["src"],Z={class:"names"},J={class:"name"},q={class:"n2"},G={class:"name"},K={class:"n2"},Q={class:"item image"},ee={class:"imageArea"},te=["src"],se={class:"drag"},ie={class:"item text"},ne={class:"submitLine"},oe={class:"item text"},le={class:"item text"},ae={class:"submitLine"},F=16,de={__name:"UserInfo",setup(re){let o=b().proxy.config.loginStatus.userinfo,x=b().proxy.screen,c=b().proxy.F;const u=r("preview"),L=r(),s=_({name:o.name,photo:o.photo,pswd1:"",pswd2:""});let d=null,p=0;const m=r(!1),y=r(!1);function z(i){p++,i.target==i.currentTarget&&(m.value=!0)}function I(i){p--;const e=i.currentTarget.getBoundingClientRect();(i.clientX<=e.left||i.clientX>=e.right||i.clientY<=e.top||i.clientY>=e.bottom)&&(p=0),p===0&&(m.value=!1)}function S(i){p=0,m.value=!1,d=i.dataTransfer.files[0],d.type.startsWith("image")&&(URL.revokeObjectURL(s.photo),s.photo=URL.createObjectURL(d))}function j(i){d=i.target.files[0],!(!d||!d.type.startsWith("image"))&&(URL.revokeObjectURL(s.photo),s.photo=URL.createObjectURL(d))}async function B(){if(!h.value||!v.value)return;v.value=!1;let i={};if(s.photo!==o.photo){let n=new FormData;n.append("photo",d);let T=await c.myFetchApi("/upload_image",{expectCodes:[200,201],errorText:"头像上传失败"},{data:n});if(!T){v.value=!0;return}i.photo=T.data}s.name!==o.name&&(i.name=s.name);let e=await c.myFetchApi("/update_info",{expectCodes:[200],errorText:"信息更新失败"},{method:"PUT",json:i});e&&(a.emit("refreshUserInfo"),a.emit("dialog",{text:e.message})),v.value=!0}const E=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@#$%^&*!]{8,16}$/;async function M(){if(!w.value)return;if(s.pswd1!==s.pswd2){a.emit("dialog",{text:"两次输入的密码不一致!"});return}if(!E.test(s.pswd1)){a.emit("dialog",{text:`密码长度须为8-16个字符，至少包含1个字母和
1个数字，可包含特殊字符(@#$%^&*)`});return}w.value=!1;let i=await c.myFetchApi("/change_password",{expectCodes:[200],errorText:"密码修改失败"},{method:"PUT",json:{password:s.pswd1}});i&&(s.pswd1=s.pswd2="",a.emit("dialog",{text:i.message})),w.value=!0}function V(){a.emit("dialog",{text:"确认要注销账号吗？",onYes(){c.myFetchApi("/cancel_account",{expectCodes:[200],errorText:"注销失败!"},{method:"DELETE"}).then(i=>{i&&(a.emit("dialog",{text:i.message}),a.emit("logout"))})},type:"yes_no"})}A(()=>{s.photo=o.photo,s.name=o.name});let h=r(!1),v=r(!0),w=r(!0);return A(()=>h.value=s.name!==o.name||s.photo!==o.photo),window.addEventListener("hashchange",()=>{u.value="preview",s.photo=o.photo,s.name=o.name,s.pswd1=s.pswd2=""}),(i,e)=>(C(),k("div",{class:f(["area",l(x).type])},[P(X,{name:"fade"},{default:N(()=>[u.value==="preview"?(C(),k("div",{key:0,class:f(["preview",l(x).type])},[e[13]||(e[13]=t("div",{class:"title"},"我的信息",-1)),t("div",Y,[t("img",{class:"photo",src:l(o).photo},null,8,H),t("div",Z,[t("div",J,[e[11]||(e[11]=t("span",{class:"n1"},"我的昵称:",-1)),t("span",q,D(l(o).name),1)]),t("div",G,[e[12]||(e[12]=t("span",{class:"n1"},"用户名:",-1)),t("span",K,D(l(o).username),1)])])]),t("div",{class:"button",onClick:e[0]||(e[0]=n=>u.value="edit")},"编辑信息"),e[14]||(e[14]=t("hr",{style:{width:"100%"}},null,-1)),e[15]||(e[15]=t("div",{class:"title"},"其他",-1)),t("div",{class:"button del",onClick:e[1]||(e[1]=n=>l(a).emit("delAllChats"))},"删除所有会话"),t("div",{class:"button del",onClick:e[2]||(e[2]=n=>V())},"注销账号")],2)):u.value==="edit"?(C(),k("div",{key:1,class:f(["edit",l(x).type])},[e[22]||(e[22]=t("div",{class:"title"},"基本信息",-1)),t("div",Q,[e[18]||(e[18]=t("div",{class:"text"},"当前头像",-1)),t("div",ee,[t("img",{class:"image",src:s.photo},null,8,te),t("div",{class:"input",onDragenter:z,onDragover:e[4]||(e[4]=R(()=>{},["prevent"])),onDrop:R(S,["prevent"]),onDragleave:I,onMouseenter:e[5]||(e[5]=n=>y.value=!0),onMouseleave:e[6]||(e[6]=n=>y.value=!1)},[g(t("div",{class:"click",onClick:e[3]||(e[3]=n=>L.value.click())},[t("input",{type:"file",style:{display:"none"},ref_key:"imageSelector",ref:L,accept:"image/*",onChange:j},null,544),e[16]||(e[16]=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200"},[t("text",{x:"100",y:"100",fill:"none",stroke:"#000","stroke-width":"4","font-size":"20",style:{"text-anchor":"middle","dominant-baseline":"middle"}},"点击上传文件"),t("text",{x:"100",y:"100",fill:"#fff","font-size":"20",style:{"text-anchor":"middle","dominant-baseline":"middle"}},"点击上传文件")],-1))],512),[[$,!m.value&&y.value]]),g(t("div",se,e[17]||(e[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200"},[t("text",{x:"100",y:"100",fill:"none",stroke:"#000","stroke-width":"4","font-size":"20",style:{"text-anchor":"middle","dominant-baseline":"middle"}},"拖拽上传文件"),t("text",{x:"100",y:"100",fill:"#fff","font-size":"20",style:{"text-anchor":"middle","dominant-baseline":"middle"}},"拖拽上传文件")],-1)]),512),[[$,m.value]])],32)])]),t("div",ie,[e[19]||(e[19]=t("div",{class:"text"},"我的昵称:",-1)),g(t("input",{type:"text",class:"input",maxlength:"20","onUpdate:modelValue":e[7]||(e[7]=n=>s.name=n)},null,512),[[U,s.name]])]),t("div",ne,[t("div",{class:f(["submitButton",{enable:l(h)&&l(v)}]),onClick:B},"提交",2)]),e[23]||(e[23]=t("div",{class:"title"},"修改密码",-1)),t("div",oe,[e[20]||(e[20]=t("div",{class:"text"},"新密码:",-1)),g(t("input",{type:"password",maxlength:F,class:"input","onUpdate:modelValue":e[8]||(e[8]=n=>s.pswd1=n)},null,512),[[U,s.pswd1]])]),t("div",le,[e[21]||(e[21]=t("div",{class:"text"},"确认新密码:",-1)),g(t("input",{type:"password",maxlength:F,class:"input","onUpdate:modelValue":e[9]||(e[9]=n=>s.pswd2=n)},null,512),[[U,s.pswd2]])]),t("div",ae,[t("div",{class:f(["submitButton",{enable:l(w)}]),onClick:M},"修改",2)]),t("div",{class:"button",onClick:e[10]||(e[10]=n=>u.value="preview"),style:{width:"400px"}},"取消")],2)):W("",!0)]),_:1})],2))}},pe=O(de,[["__scopeId","data-v-75185e8a"]]);export{pe as default};
