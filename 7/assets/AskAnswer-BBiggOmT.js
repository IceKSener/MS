import{_ as j,g as _,u as V,r as A,b as $,o as v,c as g,a as n,w as y,v as D,n as r,d,e as F,f as I,F as L,h as P,t as R,i as S,j as z,k as J,l as K,m as G}from"./index-Cs4GimgH.js";const U={class:"question_bar"},X=["title","onClick"],H=["onClick"],Q={key:0},W={__name:"AskAnswer",setup(Y){let q=_().proxy.api,h=_().proxy.config,i=_().proxy.screen;const b=V("answers"),a=A([]),f=A(""),T=s=>new Promise(e=>setTimeout(e,s));async function k(s){if(s=s.trim(),s.length<=0)return;if(!h.loginStatus.isLogged){K.emit("startLogin");return}let e=G({question:s,text:"",status:"unfinished",controller:new AbortController,fold:!1}),o="",t=[];t.push({role:"user",content:s}),fetch(q.path+"/v1/chat/completions",{signal:e.controller.signal,method:"POST",headers:{Authorization:"Bearer "+h.loginStatus.userinfo.access,"Content-Type":"application/json"},body:JSON.stringify({model:"qwen2.5-math-7b-instruct",messages:t,max_tokens:1e3,temperature:1})}).then(p=>{const B=p.body.getReader(),M=new TextDecoder;let u="";function x(){B.read().then(({done:m,value:O})=>{if(m){e.status="finished";return}u+=M.decode(O,{stream:!0});let w=0,c=0;for(;c=u.indexOf("}",w)+1,c!=0;)try{let C=JSON.parse(u.substring(0,c));if(C.final){e.status="finished";return}o+=C.choices[0].message.content,u=u.substring(c),w=0}catch{w=c}x()}).catch(m=>{if(m.name==="AbortError"){o="",e.status="finished";return}o+="[解析异常]",e.status="error",console.error(m)})}x()}).catch(p=>{if(p.name==="AbortError"){o="",e.status="finished";return}o+="[请求异常]",e.status="error",console.error(p)}),a.value.push(e);let l=0;for(;;){if(l==1&&b.value.scrollTo(0,Number.MAX_SAFE_INTEGER),l<o.length)e.text+=o.at(l),++l;else if(e.status!="unfinished")break;await T(1e3/h.settings.charPerSecond)}}async function E(s){s.controller.abort(),a.value.splice(a.value.indexOf(s),1)}function N(){a.value.forEach(s=>{s.controller.abort()}),a.value.length=0}return(s,e)=>{const o=$("Markdown");return v(),g("div",{class:r(["area",d(i).type])},[n("div",{class:r(["request",d(i).type])},[y(n("textarea",{type:"text",class:r(["requestbox",d(i).type]),"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),placeholder:"输入问题",onKeyup:e[1]||(e[1]=F(I(t=>k(f.value),["exact"]),["enter"]))},null,34),[[D,f.value]]),n("div",{class:r(["submit",d(i).type]),onClick:e[2]||(e[2]=t=>k(f.value))},"提问",2)],2),n("div",{class:r(["answers",d(i).type]),ref_key:"answers",ref:b},[n("div",null,[n("button",{onClick:N},"清空")]),(v(!0),g(L,null,P(a.value,t=>(v(),g("div",{class:r(["chat",t.status])},[n("div",U,[n("img",{class:"fold",src:"./icon/fold.png",title:t.fold?"展开":"折叠",onClick:l=>t.fold=!t.fold},null,8,X),n("div",{class:r(["question",{fold:t.fold}])},R(t.question),3),n("img",{class:"del",src:"./icon/del.png",title:"删除",onClick:l=>E(t)},null,8,H)]),y(n("br",null,null,512),[[S,!t.fold]]),y(z(o,{class:"answer",md:t.text},null,8,["md"]),[[S,!t.fold]]),t.status=="unfinished"?(v(),g("div",Q,"......")):J("",!0)],2))),256))],2)],2)}}},ee=j(W,[["__scopeId","data-v-9225e672"]]);export{ee as default};
